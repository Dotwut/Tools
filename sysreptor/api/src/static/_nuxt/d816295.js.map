{"version":3,"sources":["webpack:///./components/LoginForm.vue","webpack:///./components/LoginForm.vue?a6b6","webpack:///./components/LoginForm.vue?f925","webpack:///./components/S/Card.vue?bc9b","webpack:///./components/S/Card.vue"],"names":["i","props","username","type","String","default","data","step","actionInProgress","errorMessage","formUsername","this","password","mfaMethods","currentMfaMethod","formCode","code","computed","mfaMethodChoices","methods","loginStep","fn","res","status","$auth","fetchUser","$emit","mfa","beginMfaLogin","find","m","is_primary","response","detail","non_field_errors","DOMException","message","$toast","global","requestError","error","loginUsername","$axios","$post","mfaMethod","method_type","$nextTick","options","navigatorCredentialsGet","parseRequestOptionsFromJSON","fido2Response","loginCode","id","component","$event","preventDefault","apply","_c","attrs","model","callback","$$v","expression","_vm","value","staticClass","_v","ref","on","key","c","_e","staticRenderFns","installComponents","SBtn","SCard","_self","name"],"mappings":"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","file":"d816295.js","sourcesContent":["\nimport { get as navigatorCredentialsGet, parseRequestOptionsFromJSON } from \"@github/webauthn-json/browser-ponyfill\";\nimport { mfaMethodChoices } from '~/utils/other';\n\nexport default {\n  props: {\n    username: {\n      type: String,\n      default: null\n    },\n  },\n  data() {\n    return {\n      step: 'username',\n      actionInProgress: false,\n      errorMessage: null,\n      formUsername: {\n        username: this.username || '',\n        password: '',\n      },\n      mfaMethods: [],\n      currentMfaMethod: null,\n      formCode: {\n        code: '',\n      },\n    };\n  },\n  computed: {\n    mfaMethodChoices() {\n      return mfaMethodChoices;\n    },\n  },\n  methods: {\n    async loginStep(fn) {\n      if (this.actionInProgress) {\n        return;\n      }\n\n      try {\n        this.actionInProgress = true;\n        this.errorMessage = null;\n        \n        const res = await fn();\n        if (!res) {\n          return;\n        }\n\n        if (res.status === 'success') {\n          // trigger login in nuxt-auth\n          await this.$auth.fetchUser();\n          this.$emit('login', res);\n        } else if (res.status === 'mfa-required') {\n          this.mfaMethods = res.mfa;\n          this.beginMfaLogin(res.mfa.find(m => m.is_primary) || res.mfa[0])\n        }\n      } catch (error) {\n        if (error?.response?.data?.detail) {\n          this.errorMessage = error.response.data.detail;\n        } else if (error?.response?.data?.non_field_errors) {\n          this.errorMessage = error.response.data.non_field_errors[0];\n        } else if (error instanceof DOMException) {\n          this.errorMessage = error.message;\n        } else {\n          this.$toast.global.requestError({ error, message: 'Login failed' });\n        }\n      } finally {\n        this.actionInProgress = false;\n      }\n    },\n    async loginUsername() {\n      await this.loginStep(async () => {\n        if (!this.formUsername.username || !this.formUsername.password) {\n          this.errorMessage = 'Username and password are required';\n          return null;\n        }\n        return await this.$axios.$post('/auth/login/', this.formUsername);\n      })\n    },\n    beginMfaLogin(mfaMethod) {\n      this.currentMfaMethod = mfaMethod;\n      this.step = 'mfa';\n      this.errorMessage = null;\n      this.formCode = { code: '' };\n\n      if (this.currentMfaMethod.method_type === 'fido2') {\n        this.$nextTick(async () => {\n          await this.loginStep(async () => {\n            const options = await this.$axios.$post('/auth/login/fido2/begin/', {});\n            const fido2Response = await navigatorCredentialsGet(parseRequestOptionsFromJSON(options));\n            return await this.$axios.$post('/auth/login/fido2/complete/', fido2Response);\n          });\n        });\n      }\n    },\n    async loginCode() {\n      await this.loginStep(async () => {\n        return await this.$axios.$post('/auth/login/code/', {\n          id: this.currentMfaMethod.id,\n          code: this.formCode.code,\n        });\n      });\n    },\n  },\n};\n","import mod from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./LoginForm.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./LoginForm.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./LoginForm.vue?vue&type=template&id=50aafe83&\"\nimport script from \"./LoginForm.vue?vue&type=script&lang=js&\"\nexport * from \"./LoginForm.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* nuxt-component-imports */\ninstallComponents(component, {SBtn: require('/app/frontend/components/S/Btn.vue').default,SCard: require('/app/frontend/components/S/Card.vue').default})\n","import { render, staticRenderFns } from \"./Card.vue?vue&type=template&id=8a59a924&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('v-card',_vm._g(_vm._b({attrs:{\"outlined\":\"\"}},'v-card',_vm.$attrs,false),_vm.$listeners),[_vm._l((_vm.$scopedSlots),function(_,name){return _c('template',{slot:name},[_vm._t(name)],2)})],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}