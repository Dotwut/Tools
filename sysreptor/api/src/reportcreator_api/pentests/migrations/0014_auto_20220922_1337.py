# Generated by Django 4.0.7 on 2022-09-22 13:37

from django.db import migrations

from reportcreator_api.pentests.customfields.types import field_definition_to_dict, parse_field_definition


def migrate_add_required_to_field_definitions(apps, schema_editor):
    ProjectType = apps.get_model('pentests', 'ProjectType')
    project_types = list(ProjectType.objects.all())
    for project_type in project_types:
        project_type.finding_fields = field_definition_to_dict(parse_field_definition(project_type.finding_fields))
        project_type.report_fields = field_definition_to_dict(parse_field_definition(project_type.report_fields))
    ProjectType.objects.bulk_update(project_types, fields=['finding_fields', 'report_fields'])


class Migration(migrations.Migration):

    dependencies = [
        ('pentests', '0013_pentestfinding_template_and_more'),
    ]

    operations = [
        migrations.RunPython(code=migrate_add_required_to_field_definitions, reverse_code=migrations.RunPython.noop),
    ]
