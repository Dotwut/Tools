# Generated by Django 4.0.4 on 2022-08-22 09:18

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


def generate_uploadedimage_name(apps, schema_editor):
    UploadedImage = apps.get_model('pentests', 'UploadedImage')
    imgs = list(UploadedImage.objects.all())
    for img in imgs:
        img.name = img.file.name
    UploadedImage.objects.bulk_update(imgs, fields=['name'])


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('pentests', '0005_reportsection_alter_findingtemplate_options_and_more'),
    ]

    operations = [
        migrations.RenameField(
            model_name='uploadedasset',
            old_name='project_type',
            new_name='linked_object',
        ),
        migrations.AddField(
            model_name='uploadedasset',
            name='uploaded_by',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
        ),
        migrations.AlterUniqueTogether(
            name='uploadedasset',
            unique_together={('linked_object', 'name')},
        ),

        migrations.RenameField(
            model_name='uploadedimage',
            old_name='image',
            new_name='file',
        ),
        migrations.RenameField(
            model_name='uploadedimage',
            old_name='project',
            new_name='linked_object',
        ),
        migrations.AddField(
            model_name='uploadedimage',
            name='uploaded_by',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='uploadedimage',
            name='name',
            field=models.CharField(db_index=True, default='', max_length=255),
        ),
        migrations.RunPython(
            code=generate_uploadedimage_name, reverse_code=migrations.RunPython.noop,
        ),
        migrations.AlterUniqueTogether(
            name='uploadedimage',
            unique_together={('linked_object', 'name')},
        ),
    ]
