# Generated by Django 4.0.7 on 2022-10-23 08:47

from django.db import migrations, models
import django.db.models.deletion

from reportcreator_api.pentests.models import SourceEnum


def migrate_to_source_enum(apps, schema_editor):
    ProjectType = apps.get_model('pentests', 'ProjectType')
    FindingTemplate = apps.get_model('pentests', 'FindingTemplate')
    PentestProject = apps.get_model('pentests', 'PentestProject')

    FindingTemplate.objects \
        .filter(imported=True) \
        .update(source=SourceEnum.IMPORTED)
    PentestProject.objects \
        .filter(imported=True) \
        .update(source=SourceEnum.IMPORTED)
    ProjectType.objects \
        .filter(imported=True) \
        .filter(hidden=False) \
        .update(source=SourceEnum.IMPORTED)
    ProjectType.objects \
        .filter(imported=True) \
        .filter(hidden=True) \
        .update(source=SourceEnum.IMPORTED_DEPENDENCY)


class Migration(migrations.Migration):

    dependencies = [
        ('pentests', '0017_pentestproject_readonly'),
    ]

    operations = [
        migrations.AddField(
            model_name='findingtemplate',
            name='source',
            field=models.CharField(choices=[('created', 'Created'), ('imported', 'Imported'), ('imported_dependency', 'Imported Dependency'), ('customized', 'Customized')], db_index=True, default='created', editable=False, max_length=50),
        ),
        migrations.AddField(
            model_name='pentestproject',
            name='source',
            field=models.CharField(choices=[('created', 'Created'), ('imported', 'Imported'), ('imported_dependency', 'Imported Dependency'), ('customized', 'Customized')], db_index=True, default='created', editable=False, max_length=50),
        ),
        migrations.AddField(
            model_name='projecttype',
            name='source',
            field=models.CharField(choices=[('created', 'Created'), ('imported', 'Imported'), ('imported_dependency', 'Imported Dependency'), ('customized', 'Customized')], db_index=True, default='created', editable=False, max_length=50),
        ),
        migrations.RunPython(code=migrate_to_source_enum),
        migrations.RemoveField(
            model_name='findingtemplate',
            name='imported',
        ),
        migrations.RemoveField(
            model_name='pentestproject',
            name='imported',
        ),
        migrations.RemoveField(
            model_name='projecttype',
            name='hidden',
        ),
        migrations.RemoveField(
            model_name='projecttype',
            name='imported',
        ),
    ]
